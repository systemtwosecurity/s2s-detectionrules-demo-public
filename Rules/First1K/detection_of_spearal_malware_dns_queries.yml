# review_report_url: https://research.checkpoint.com/2024/iranian-malware-attacks-iraqi-government/https://research.checkpoint.com/2024/iranian-malware-attacks-iraqi-government/
# review_date: 2024-10-08
# review_author: Blackpearl
# review_rule_useful: true
# review_rule_classification: proceed to testing
# review_rule_classification_reason: na
# review_rule_ttp_match: yes
# review_notes:
#  - This Sigma rule aims to detect DNS queries indicative of the Spearal malware's command requests to its C2 server using DNS tunneling with a custom Base32 encoding scheme.The rule's logic correctly focuses on the "cmd:;" prefix, which is a strong indicator of Spearal malware activity. However, there's a potential for false positives if any legitimate applications use similar Base32 encoded DNS queries, though this is unlikely as noted in the rule.
title: Detection of Spearal Malware DNS Command Queries
id: ed199088-8f8a-494b-8a57-7f06c9ad3c8d
status: experimental
description: Detects DNS queries that are indicative of the Spearal malware, which uses a custom Base32 encoding scheme to communicate with its C2 server using DNS tunneling. The rule looks for DNS queries that contain a base32 encoded string starting with "cmd:;".
references:
  - https://research.checkpoint.com/2024/iranian-malware-attacks-iraqi-government
author: System Two Security
date: 2024/10/03
tags:
  - attack.command-and-control
  - attack.t1071.004
logsource:
  product: zeek
  service: dns
detection:
  query:
    query|contains: cmd:;
  condition: query
falsepositives:
  - Legitimate applications that use Base32 encoding in DNS queries in a similar format (very unlikely)
level: high
