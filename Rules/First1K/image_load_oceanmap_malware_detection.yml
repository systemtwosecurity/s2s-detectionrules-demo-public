# review_report_url:https://harfanglab.io/insidethelab/compromised-routers-infrastructure-target-europe-caucasus/
# review_date: 2024-10-26
# review_author: Blackpearl
# review_rule_useful: true
# review_rule_classification: proceed to testing
# review_rule_classification_reason: na
# review_rule_ttp_match: yes
# review_notes:
#  - The detection rule for OCEANMAP malware effectively targets known behaviors detailed in the HarfangLab report. It identifies specific IMAP commands and unique identifiers associated with OCEANMAP's operation, confirming its alignment with the reported tactics of leveraging emails for command and control.

title: Detection of OCEANMAP Malware
id: 8b8f7714-9497-4f34-acfb-cf1928e73601
status: experimental
description: Detects the presence of OCEANMAP malware by looking for specific strings related to .NET Framework, IMAP commands, and other unique identifiers, as well as checking for the Windows executable file header and a specific file size range.
references:
  - https://harfanglab.io/insidethelab/compromised-routers-infrastructure-target-europe-caucasus
author: System Two Security
date: 2024/10/25
tags:
  - attack.persistence
logsource:
  product: windows
  category: image_load
detection:
  selection:
    ImageLoaded|contains|all:
      - BODY.PEEK[text]
      - SELECT Drafts
      - screds
      - +FLAGS (\Deleted)
      - r_creds
      - UID SEARCH subject
      - APPEND INBOX {
      - EXPUNGE
      - comp_id
      - taskkill /F /PID
      - cmd.exe
      - change_time
      - fcreds
      - changesecond
      - .NETFramework,Version
      - SELECT INBOX.Drafts
      - ReplaceBytes
  condition: selection
falsepositives:
  - Legitimate software that uses similar IMAP commands or strings for benign purposes
  - Developers' tools or scripts that manipulate IMAP commands or use .NET Framework identifiers
level: high
