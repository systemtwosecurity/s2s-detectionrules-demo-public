# review_report_url:  https://cloud.google.com/blog/topics/threat-intelligence/apt41-initiates-global-intrusion-campaign-using-multiple-exploits
# review_date: 2024-11-03
# review_author: Blackpearl
# review_rule_useful: true
# review_rule_classification: proceed to testing
# review_rule_classification_reason: na
# review_rule_ttp_match: yes
# review_notes:
#  - This Sigma rule identifies potential exploitation of CVE-2019-19781 by detecting crafted HTTP POST requests to a specific endpoint with malicious parameters indicative of template injection attacks. It flags suspicious activity targeting VPN portals with indicators common to APT exploitation attempts.
title: Detection of CVE-2019-19781 Exploitation via HTTP POST
id: 285a4746-5063-42d8-9508-07fc0a90a367
status: experimental
description: Detects a specific HTTP POST request to /vpns/portal/scripts/newbm.pl with a crafted NSC_USER parameter and a malicious desc parameter containing a template injection, which is indicative of CVE-2019-19781 exploitation attempts.
references:
  - https://cloud.google.com/blog/topics/threat-intelligence/apt41-initiates-global-intrusion-campaign-using-multiple-exploits
author: System Two Security
date: 2024/08/22
tags:
  - attack.command_and_control
logsource:
  product: zeek
  service: http
detection:
  selection1:
    method: POST
    uri|endswith: /vpns/portal/scripts/newbm.pl
    client_header_names|contains:
      - NSC_NONCE
      - NSC_USER
    request_body_len: '>0'
  selection2:
    request_body_len: '>0'
    client_header_names|contains:
      - NSC_NONCE
      - NSC_USER
    uri|endswith: /vpns/portal/scripts/newbm.pl
  filter1:
    request_body_len|contains|all:
      - template.new(
      - '`file /bin/pwd`'
  filter2:
    request_body_len|contains|all:
      - template.new(
      - '`/usr/bin/ftp -o /tmp/'
  condition: (selection1 and filter1) or (selection2 and filter2)
falsepositives:
  - Legitimate administrative activity that uses the same endpoint and parameters in a non-malicious manner.
level: high
